# Learn more about services, parameters and containers at
# http://symfony.com/doc/current/book/service_container.html
parameters:
#    parameter_name: value

services:
#    service_name:
#        class: AppBundle\Directory\ClassName
#        arguments: ["@another_service_name", "plain_value", "%parameter_name%"]

    # workaround for implicit dependency on PHP templating library.
    # see https://github.com/liip/LiipMonitorBundle/issues/125#issuecomment-220337440
    templating.helper.assets: '@assets.packages'
    templating.helper.router: '@router'

    check_couchdb:
        class: ZendDiagnostics\Check\CouchDBCheck
        arguments:
            -
                dbname: '%couchdb_name%'
                host: '%couchdb_host%'
                protocol: 'http'
                port: '%couchdb_port%'
                username: '%couchdb_user%'
                password: '%couchdb_password%'
        calls:
            - [ setLabel, ['CouchDB']]
        tags:
            - { name: liip_monitor.check, alias: couchdb }

    check_elasticsearch:
        class: ZendDiagnostics\Check\GuzzleHttpService
        arguments:
            - 'http://%elasticsearch_host%:%elasticsearch_port%/_cluster/health'
            - []
            - []
            - 200
            - status
        calls:
            - [ setLabel, ['Elasticsearch']]
        tags:
            - { name: liip_monitor.check, alias: elasticsearch }

    amqp.callback.noop:
        class: AppBundle\RabbitMQ\NoopMessageConsumer

    bangpound_guzzle_proxy.client.couchdb:
        parent: bangpound_guzzle_proxy.client
        arguments:
          -
            base_url: 'http://%couchdb_host%:%couchdb_port%/%couchdb_name%/'
            auth: ['%couchdb_user%', '%couchdb_password%']

    bangpound_guzzle_proxy.client.elasticsearch:
        parent: bangpound_guzzle_proxy.client
        arguments:
          -
            base_url: 'http://%elasticsearch_host%:%elasticsearch_port%/%elasticsearch_index_name%/'

    monolog.processor.psr_log_message_processor:
        class: Monolog\Processor\PsrLogMessageProcessor
        tags:
            - { name: monolog.processor }

    aws.endpoint.provider:
        class: Aws\Endpoint\PatternEndpointProvider
        arguments: ['%aws_endpoint_map%']

    aws.signature.provider:
        class: Aws\Signature\SignatureInterface
        factory: ['AppBundle\Security\SignatureProvider', 'create']

    s3_consumer:
        class: AppBundle\Consumer\S3Consumer
        arguments: ['@aws.s3']

    atom_consumer:
        class: AppBundle\Consumer\AtomConsumer
        arguments: ['@old_sound_rabbit_mq.atom_producer', '@serializer']

    elasticsearch_consumer:
        class: AppBundle\Consumer\ElasticsearchConsumer
        arguments: ['@es.manager.default', 'AppBundle\Document\AtomEntry']
        calls:
            - ['setSerializer', ['@serializer']]
            - [ 'setLogger', ['@logger']]

    custom_normalizer:
        class: Symfony\Component\Serializer\Normalizer\CustomNormalizer
        public: false
        tags:
            - { name: serializer.normalizer }

    property_info_type_extractor:
        class: AppBundle\Extractor\PropertyInfoTypeExtractor
        arguments: ['@annotation_reader']
        tags:
            - { name: property_info.type_extractor }

    couchdb_consumer:
        class: AppBundle\Consumer\CouchDbConsumer
        arguments: [ "@doctrine_couchdb.client.default_connection", 'AppBundle\CouchDocument\AtomEntry' ]
        calls:
            - [ 'setSerializer', ['@serializer']]
            - [ 'setLogger', ['@logger']]

