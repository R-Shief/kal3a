{% extends "@BangpoundCastleSearch/layout.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets filter='cssrewrite' %}
    <link href="{{ asset_url }}" type="text/css" rel="stylesheet" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,300,700' rel='stylesheet' type='text/css'>
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts
        "@underscore_js"
        "@underscore_string_js"
        "@angular_js"
        "@angular_sanitize_js"
        "@angular_resource_js"
        "@angular_bootstrap_js"
        "@elasticsearch_angular_js"
        "@elastic_js_js"
        "@d3_js"
        "@n3_charts_line_chart_js"
        "@CornerCouch_js"
        "@BangpoundCastleSearchBundle/Resources/public/js/app.js"
        "@BangpoundCastleSearchBundle/Resources/public/js/controllers.js"
        "@BangpoundCastleSearchBundle/Resources/public/js/components.js"
        "@BangpoundCastleSearchBundle/Resources/public/js/filters.js"
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block body_controller %} ng-controller="SearchCtrl" ng-cloak{% endblock %}

{% block navbar %}
    {{ parent() }}
<div class="global-search active">
	<div class="container">
	    <div class="search-logo"><a href="/"><img src="bundles/rshiefkal3a/images/r-shief-web.png" alt="R-Shief"></a></div>

	    <form ng-submit="search()" class="form-inline facetview_search_options_container">
	        <div class="btn-group">
	            <a class="search-info" title="Search Help" data-toggle="modal" data-target="#search-help">
	                <i class="glyphicon glyphicon-question-sign"></i>
	            </a>
	        </div>
	        <div class="form-group">
	            <input class="form-control" ng-model="queryTerm" placeholder="Search our Archive | &#1573;&#1576;&#1581;&#1579; &#1571;&#1585;&#1588;&#1610;&#1601;"type="search" />
	        </div>

	        <div class="search-variables">
	            {% include '@BangpoundCastleSearch/modal_results.html.twig' %}
	            <a id="changeResults" title="change result set size" data-toggle="modal" data-target="#modal-results">
	                Results
	            </a>

	            <button data-toggle="tooltip" data-placement="bottom" title="Sort Ascending" type="button" class="btn btn-default" ng-model="sort" btn-radio="'asc'"><i class="glyphicon glyphicon-sort-by-attributes-alt fa-flip-vertical"></i></button>
	            <button data-toggle="tooltip" data-placement="bottom" title="Sort Descending" type="button" class="btn btn-default" ng-model="sort" btn-radio="'desc'"><i class="glyphicon glyphicon-sort-by-attributes-alt"></i></button>
	            <button data-toggle="tooltip" data-placement="bottom" title="Sort by Relevance" type="button" class="btn btn-default" ng-model="sort" btn-radio="'_score'"><i class="glyphicon glyphicon-sort-by-order-alt"></i></button>
	        </div>
	        <button ng-click="search()" type="submit"><i class="glyphicon glyphicon-search"></i></button>
	    </form>
	 </div>
</div>
{% endblock %}

{% block header %}
    <h1 class="pagetitle">
        <span class="notify_loading" ng-show="loading"><i class="fa fa-spinner fa-spin"></i> Updating</span> Results
    </h1>
{% endblock %}

{% block sidebar %}
    <div class="panel panel-default" ng-repeat="(key, value) in results.facets" ng-show="value._type == 'terms' && (value.total > 0 || value._type != 'terms')" ng-switch on="value._type">
        <div class="panel-heading" data-toggle="collapse" data-target="#facet-{% verbatim %}{{$index}}{% endverbatim %}">
            <h3 class="panel-title">{% verbatim %}{{ key }}{% endverbatim %}</h3>
        </div>
        <ul id="facet-{% verbatim %}{{$index}}{% endverbatim %}" class="list-group list-unstyled facets collapse in" ng-switch-when="terms" ng-controller="TermFacet" ng-init="init(key, query)">
            <li class="list-group-item" ng-repeat="entry in value.terms" dir="{% verbatim %}{{ entry.term | directionality }}{% endverbatim %}" ng-switch on="key">
                <a ng-click="filter(key, entry.term)" ng-switch-when="Collection">
                    <i class="glyphicon glyphicon-remove-sign" ng-show="isActive(key, entry.term)"></i> {% verbatim %}{{ typeNames[entry.term] }}{% endverbatim %}
                </a>
                <a ng-click="filter(key, entry.term)" ng-switch-default>
                    <i class="glyphicon glyphicon-remove-sign" ng-show="isActive(key, entry.term)"></i> {% verbatim %}{{ entry.term }}{% endverbatim %}
                </a> <span class="badge">{% verbatim %}{{ entry.count | number }}{% endverbatim %}</span>
            </li>
        </ul>
    </div>
{% endblock %}

{% block main %}
    <ul class="list-unstyled">
        <li ng-repeat="doc in results.hits.hits" class="media">
            <div class="pull-left">
                <div class="thumbnail">
                	<span class="helper"></span>
                    <img ng-src="{% verbatim %}{{doc.castleView.thumbnailLink.href}}{% endverbatim %}" alt="{% verbatim %}{{doc._source.name}}{% endverbatim %}" />
                </div>
            </div>
            <div class="media-body">
                <p class="author">
                    <a ng-if="doc.castleView.authorLink" href="{% verbatim %}{{ doc.castleView.authorLink.href }}{% endverbatim %}" target="_blank">
                        {% verbatim %}{{ doc._source.authors[0].name }}{% endverbatim %}
                    </a>
                    <span ng-if="!doc.castleView.authorLink">
                        {% verbatim %}{{ doc._source.authors[0].name }}{% endverbatim %}
                    </span>
                </p>
                <p class="date">
	                <span>{% verbatim %}{{ doc._source.source.title.text}}{% endverbatim %}</span>
	                <span>{% verbatim %}{{ doc._source.published | badDate | date:'medium' }}{% endverbatim %}</span>
	            </p>
                <p>
                    <a ng-if="doc.castleView.alternateLink" ng-bind-html="doc._source.title.text | unsafe" ng-href="{% verbatim %}{{ doc.castleView.alternateLink.href }}{% endverbatim %}" target="_blank"></a>
                    <span ng-if="!doc.castleView.alternateLink" ng-bind-html="doc._source.title.text | unsafe"></span>
                    <small ng-show="doc.castleView.canonicalLink">
                        <a ng-href="{% verbatim %}{{ doc.castleView.canonicalLink.href }}{% endverbatim %}" target="_blank">
                            <i class="glyphicon glyphicon-link"></i>
                        </a>
                    </small>
                </p>
                <atom-text-construct atom-element="doc._source.summary"></atom-text-construct>
                <ul>
                    <li ng-repeat="(key, value) in doc.castleView.displayLinks">
                        <a rel="{% verbatim %}{{ value.rel }}{% endverbatim %}" href="{% verbatim %}{{ value.href }}{% endverbatim %}" target="_blank">{% verbatim %}{{ value.title }}{% endverbatim %}</a>
                    </li>
                </ul>
            </div>
        </li>
    </ul>
    <pagination items-per-page="pager.limit" boundary-links="true" rotate="false" total-items="results.hits.total" page="page" max-size="10" on-select-page="setPage(page)"></pagination>
{% endblock %}

{% block content %}
    {#<div class="row">#}
        {#<div class="col-12 col-lg-12">#}
            {#<fs-date-histo bind="results.facets['Date posted']" on-click="filterByDate" />#}
        {#</div>#}
    {#</div>#}
    <div class="row">
        <div class="col-12 col-lg-4">
            {{ block('sidebar') }}
        </div>
        <div class="col-12 col-lg-8">
            {{ block('main') }}
        </div>
    </div>
{% endblock %}
